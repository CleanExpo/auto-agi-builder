import React, { useEffect } from 'react';
import Head from 'next/head';
import { useRouter } from 'next/router';
import { CombinedProvider } from '../contexts';
import NotificationsContainer from '../components/common/NotificationsContainer';
import ModalContainer from '../components/common/ModalContainer';
import AnalyticsConsent from '../components/common/AnalyticsConsent';

// Import global styles
import '../styles/globals.css';
import '../styles/animation.css';

/**
 * Main application component wrapper
 * Sets up global providers, UI elements, and styling
 */
function MyApp({ Component, pageProps }) {
  // Use Next.js router for analytics page tracking
  const router = useRouter();
  
  // Use the layout defined at the page level, if available
  const getLayout = Component.getLayout || ((page) => page);

  return (
    <CombinedProvider>
      {/* Analytics consent banner and initialization */}
      <AnalyticsConsent>
        <Head>
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Auto AGI Builder</title>
          <meta name="description" content="AI-powered software development assistant for prototyping, planning, and analysis" />
          <link rel="icon" href="/favicon.ico" />
          
          {/* Open Graph metadata for social sharing */}
          <meta property="og:title" content="Auto AGI Builder" />
          <meta property="og:description" content="Transform your ideas into software reality with AI assistance" />
          <meta property="og:image" content="/og-image.png" />
          <meta property="og:url" content="https://autoagibuilder.com" />
          <meta property="og:type" content="website" />
          
          {/* Twitter card metadata */}
          <meta name="twitter:card" content="summary_large_image" />
          <meta name="twitter:title" content="Auto AGI Builder" />
          <meta name="twitter:description" content="Transform your ideas into software reality with AI assistance" />
          <meta name="twitter:image" content="/og-image.png" />
        </Head>
        
        {/* Global UI elements that need to appear on all pages */}
        <NotificationsContainer />
        <ModalContainer />
        
        {/* 
          Apply any custom layout wrapper defined in the page component,
          or just render the page component directly if no layout is defined
        */}
        {getLayout(<ProjectProvider>
        <Component {...pageProps} />
      </ProjectProvider>)}
      </AnalyticsConsent>
    </CombinedProvider>
  );
}

export default MyApp;

